<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head.html"></head>
<body>
<script>
  $(document).ready(function() {
    $('#cartContainer').on('click', function () {
      $('#cart').toggle();
    });

    $('button.addCartBtn').on('click', function () {
      const productId = $(this).val();
      const productNameAndPrice = $(this).attr('title');
      const productNameAndPriceArr = productNameAndPrice.split('|');
      const productName = productNameAndPriceArr[0];
      const productPrice = productNameAndPriceArr[1];

      $.ajax({
        url: "/cart/add",
        type: "POST",
        data: {productId: productId, productName: productName, productPrice: productPrice},
        cache: false,
        async: true,
        success: function (data) {
          const cartCounter = '#cartCounter';
          $(cartCounter).text(+($(cartCounter).text()) + 1);
          $('#cart').html(data);
        }
     });
    });
  });
</script>
<div class="container">
  <div id="cartContainer" class="row">
    <button type="button" class="btn btn-outline-danger mb-3">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart"
           viewBox="0 0 16 16">
        <path
            d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path>
      </svg>
      Cart (<span id="cartCounter">0</span>)
    </button>
    <ul id="cart" style="display: none; margin-left: 20px;">
      <li th:each="cartItem : ${cartItems}">
        <a th:text="${cartItem.productName}"></a>
      </li>
    </ul>
  </div>
  <div class="row">
    <div class="col" th:each="item : ${products}">
      <b><span th:text="${item.name}"></span></b><br>
      <span th:text="${item.price}"></span> &euro;<br>
      <button type="button" class="addCartBtn btn btn-outline-danger mb-3" th:title="${item.name + '|' + item.price.doubleValue()}" th:value="${item.id}">Add to Cart</button>
    </div>
  </div>
</div>
</body>
</html>